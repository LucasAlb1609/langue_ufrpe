"""
Script para gerar dados de teste para a aplica√ß√£o de Publica√ß√µes PDF
Execute este script no Django shell: python manage.py shell
Depois execute: exec(open('publicacoes/test_data.py').read())
"""

import os
import random
from datetime import datetime, timedelta
from django.core.files.base import ContentFile
from django.conf import settings
from publicacoes.models import Organizador, PublicacaoPDF, ConfiguracaoPaginaPublicacoes

def criar_dados_teste():
    """Cria dados de teste para a aplica√ß√£o de publica√ß√µes"""
    
    print("üöÄ Iniciando cria√ß√£o de dados de teste para Publica√ß√µes PDF...")
    
    # Limpar dados existentes (opcional - descomente se quiser limpar)
    # print("üßπ Limpando dados existentes...")
    # PublicacaoPDF.objects.all().delete()
    # Organizador.objects.all().delete()
    # ConfiguracaoPaginaPublicacoes.objects.all().delete()
    
    # 1. Criar configura√ß√£o da p√°gina
    print("üìÑ Criando configura√ß√£o da p√°gina...")
    configuracao, created = ConfiguracaoPaginaPublicacoes.objects.get_or_create(
        ativa=True,
        defaults={
            'titulo_pagina': 'Publica√ß√µes LANGUE UFRPE',
            'descricao_pagina': 'Explore nossa cole√ß√£o de publica√ß√µes acad√™micas em PDF, incluindo livros, artigos, relat√≥rios e outros materiais de pesquisa do Laborat√≥rio de Estudos da Linguagem, Literatura e Hist√≥ria.',
            'publicacoes_por_pagina': 12,
            'mostrar_estatisticas': True,
        }
    )
    
    if created:
        print("‚úÖ Configura√ß√£o da p√°gina criada com sucesso!")
    else:
        print("‚ÑπÔ∏è Configura√ß√£o da p√°gina j√° existe.")
    
    # 2. Criar organizadores
    print("üë• Criando organizadores...")
    
    organizadores_data = [
        {
            'nome': 'Dr. Jo√£o Silva Santos',
            'biografia': 'Doutor em Lingu√≠stica pela UFPE, especialista em an√°lise do discurso e sociolingu√≠stica.',
            'lattes_link': 'http://lattes.cnpq.br/1234567890123456',
            'email': 'joao.santos@ufrpe.edu.br'
        },
        {
            'nome': 'Dra. Maria Fernanda Oliveira',
            'biografia': 'Doutora em Literatura Brasileira pela USP, pesquisadora em literatura contempor√¢nea.',
            'lattes_link': 'http://lattes.cnpq.br/2345678901234567',
            'email': 'maria.oliveira@ufrpe.edu.br'
        },
        {
            'nome': 'Dr. Carlos Eduardo Mendes',
            'biografia': 'Doutor em Hist√≥ria pela UFMG, especialista em hist√≥ria do Brasil colonial.',
            'lattes_link': 'http://lattes.cnpq.br/3456789012345678',
            'email': 'carlos.mendes@ufrpe.edu.br'
        },
        {
            'nome': 'Dra. Ana Paula Costa',
            'biografia': 'Doutora em Letras pela UFRJ, pesquisadora em lingu√≠stica aplicada.',
            'lattes_link': 'http://lattes.cnpq.br/4567890123456789',
            'email': 'ana.costa@ufrpe.edu.br'
        },
        {
            'nome': 'Dr. Roberto Lima Ferreira',
            'biografia': 'Doutor em Educa√ß√£o pela UNICAMP, especialista em ensino de l√≠ngua portuguesa.',
            'lattes_link': 'http://lattes.cnpq.br/5678901234567890',
            'email': 'roberto.ferreira@ufrpe.edu.br'
        },
        {
            'nome': 'Dra. Luciana Barbosa Alves',
            'biografia': 'Doutora em Comunica√ß√£o pela UFRGS, pesquisadora em m√≠dia e sociedade.',
            'lattes_link': 'http://lattes.cnpq.br/6789012345678901',
            'email': 'luciana.alves@ufrpe.edu.br'
        },
        {
            'nome': 'Dr. Fernando Augusto Rocha',
            'biografia': 'Doutor em Filosofia pela PUC-SP, especialista em filosofia da linguagem.',
            'lattes_link': 'http://lattes.cnpq.br/7890123456789012',
            'email': 'fernando.rocha@ufrpe.edu.br'
        },
        {
            'nome': 'Dra. Patr√≠cia Gomes Nascimento',
            'biografia': 'Doutora em Antropologia pela UnB, pesquisadora em cultura popular.',
            'lattes_link': 'http://lattes.cnpq.br/8901234567890123',
            'email': 'patricia.nascimento@ufrpe.edu.br'
        }
    ]
    
    organizadores_criados = []
    for org_data in organizadores_data:
        organizador, created = Organizador.objects.get_or_create(
            nome=org_data['nome'],
            defaults=org_data
        )
        organizadores_criados.append(organizador)
        if created:
            print(f"‚úÖ Organizador criado: {organizador.nome}")
        else:
            print(f"‚ÑπÔ∏è Organizador j√° existe: {organizador.nome}")
    
    # 3. Criar publica√ß√µes
    print("üìö Criando publica√ß√µes...")
    
    publicacoes_data = [
        {
            'titulo': 'An√°lise do Discurso Pol√≠tico no Brasil Contempor√¢neo',
            'subtitulo': 'Uma Abordagem Sociolingu√≠stica',
            'categoria': 'LIVRO',
            'descricao': 'Este livro apresenta uma an√°lise abrangente do discurso pol√≠tico brasileiro contempor√¢neo, utilizando ferramentas da sociolingu√≠stica para compreender as estrat√©gias discursivas empregadas por diferentes atores pol√≠ticos.',
            'ano_publicacao': 2024,
            'editora': 'Editora Universit√°ria UFRPE',
            'isbn': '978-85-7946-123-4',
            'numero_paginas': 280,
            'destaque': True,
            'downloads': random.randint(50, 200)
        },
        {
            'titulo': 'Literatura e Identidade Regional',
            'subtitulo': 'Narrativas do Nordeste Brasileiro',
            'categoria': 'LIVRO',
            'descricao': 'Uma colet√¢nea de ensaios sobre a literatura nordestina e sua contribui√ß√£o para a forma√ß√£o da identidade regional brasileira.',
            'ano_publicacao': 2023,
            'editora': 'Editora Massangana',
            'isbn': '978-85-7946-124-1',
            'numero_paginas': 320,
            'destaque': True,
            'downloads': random.randint(30, 150)
        },
        {
            'titulo': 'Hist√≥ria Oral e Mem√≥ria Coletiva',
            'categoria': 'REVISTA',
            'descricao': 'Artigo publicado na Revista de Hist√≥ria da UFRPE sobre metodologias de hist√≥ria oral e sua import√¢ncia para a preserva√ß√£o da mem√≥ria coletiva.',
            'ano_publicacao': 2023,
            'editora': 'Revista de Hist√≥ria UFRPE',
            'numero_paginas': 25,
            'downloads': random.randint(20, 80)
        },
        {
            'titulo': 'Ensino de L√≠ngua Portuguesa na Era Digital',
            'subtitulo': 'Desafios e Oportunidades',
            'categoria': 'MANUAL',
            'descricao': 'Manual pr√°tico para professores sobre como integrar tecnologias digitais no ensino de l√≠ngua portuguesa.',
            'ano_publicacao': 2024,
            'editora': 'UFRPE Press',
            'numero_paginas': 150,
            'downloads': random.randint(40, 120)
        },
        {
            'titulo': 'Anais do III Simp√≥sio de Lingu√≠stica Aplicada',
            'categoria': 'ANAIS',
            'descricao': 'Colet√¢nea de trabalhos apresentados no III Simp√≥sio de Lingu√≠stica Aplicada da UFRPE, abordando temas contempor√¢neos da √°rea.',
            'ano_publicacao': 2023,
            'editora': 'UFRPE',
            'numero_paginas': 450,
            'downloads': random.randint(60, 180)
        },
        {
            'titulo': 'Relat√≥rio de Pesquisa: Varia√ß√£o Lingu√≠stica no Agreste Pernambucano',
            'categoria': 'RELATORIO',
            'descricao': 'Relat√≥rio final da pesquisa sobre varia√ß√£o lingu√≠stica realizada em comunidades rurais do agreste pernambucano.',
            'ano_publicacao': 2022,
            'numero_paginas': 95,
            'downloads': random.randint(15, 60)
        },
        {
            'titulo': 'Guia de Reda√ß√£o Acad√™mica',
            'subtitulo': 'Normas e Pr√°ticas para Trabalhos Cient√≠ficos',
            'categoria': 'GUIA',
            'descricao': 'Guia completo para elabora√ß√£o de trabalhos acad√™micos, incluindo normas ABNT e t√©cnicas de escrita cient√≠fica.',
            'ano_publicacao': 2024,
            'editora': 'Editora Universit√°ria UFRPE',
            'numero_paginas': 120,
            'destaque': True,
            'downloads': random.randint(80, 250)
        },
        {
            'titulo': 'Cultura Popular e Tradi√ß√µes Orais',
            'categoria': 'LIVRO',
            'descricao': 'Estudo antropol√≥gico sobre as tradi√ß√µes orais e manifesta√ß√µes da cultura popular no interior de Pernambuco.',
            'ano_publicacao': 2022,
            'editora': 'Editora Massangana',
            'isbn': '978-85-7946-125-8',
            'numero_paginas': 200,
            'downloads': random.randint(25, 90)
        },
        {
            'titulo': 'Filosofia da Linguagem: Perspectivas Contempor√¢neas',
            'categoria': 'REVISTA',
            'descricao': 'Artigo sobre as principais correntes da filosofia da linguagem no s√©culo XXI.',
            'ano_publicacao': 2023,
            'editora': 'Revista de Filosofia UFRPE',
            'numero_paginas': 30,
            'downloads': random.randint(10, 50)
        },
        {
            'titulo': 'M√≠dia Digital e Transforma√ß√µes Sociais',
            'subtitulo': 'Impactos na Comunica√ß√£o Contempor√¢nea',
            'categoria': 'LIVRO',
            'descricao': 'An√°lise dos impactos das m√≠dias digitais nas transforma√ß√µes sociais e comunicacionais da sociedade contempor√¢nea.',
            'ano_publicacao': 2024,
            'editora': 'Editora Universit√°ria UFRPE',
            'isbn': '978-85-7946-126-5',
            'numero_paginas': 240,
            'downloads': random.randint(35, 110)
        },
        {
            'titulo': 'Manual de Metodologia de Pesquisa em Humanidades',
            'categoria': 'MANUAL',
            'descricao': 'Manual abrangente sobre metodologias de pesquisa espec√≠ficas para as √°reas de humanidades.',
            'ano_publicacao': 2023,
            'editora': 'UFRPE Press',
            'numero_paginas': 180,
            'downloads': random.randint(45, 140)
        },
        {
            'titulo': 'Colet√¢nea de Textos Liter√°rios Regionais',
            'categoria': 'OUTROS',
            'descricao': 'Sele√ß√£o de textos liter√°rios de autores regionais, com an√°lises cr√≠ticas e contextualiza√ß√µes hist√≥ricas.',
            'ano_publicacao': 2022,
            'editora': 'Editora Regional',
            'numero_paginas': 300,
            'downloads': random.randint(20, 75)
        }
    ]
    
    publicacoes_criadas = []
    for pub_data in publicacoes_data:
        # Criar a publica√ß√£o
        publicacao, created = PublicacaoPDF.objects.get_or_create(
            titulo=pub_data['titulo'],
            defaults=pub_data
        )
        
        if created:
            # Adicionar organizadores aleat√≥rios (1-3 organizadores por publica√ß√£o)
            num_organizadores = random.randint(1, 3)
            organizadores_selecionados = random.sample(organizadores_criados, num_organizadores)
            publicacao.organizadores.set(organizadores_selecionados)
            
            publicacoes_criadas.append(publicacao)
            print(f"‚úÖ Publica√ß√£o criada: {publicacao.titulo}")
            print(f"   Organizadores: {', '.join([org.nome for org in organizadores_selecionados])}")
        else:
            publicacoes_criadas.append(publicacao)
            print(f"‚ÑπÔ∏è Publica√ß√£o j√° existe: {publicacao.titulo}")
    
    # 4. Estat√≠sticas finais
    print("\nüìä Estat√≠sticas dos dados criados:")
    print(f"   üë• Organizadores: {Organizador.objects.count()}")
    print(f"   üìö Publica√ß√µes: {PublicacaoPDF.objects.count()}")
    print(f"   ‚≠ê Publica√ß√µes em destaque: {PublicacaoPDF.objects.filter(destaque=True).count()}")
    print(f"   üìÖ Anos de publica√ß√£o: {PublicacaoPDF.objects.values_list('ano_publicacao', flat=True).distinct().count()}")
    
    # Estat√≠sticas por categoria
    print("\nüìà Publica√ß√µes por categoria:")
    for categoria, nome in PublicacaoPDF.CATEGORIA_CHOICES:
        count = PublicacaoPDF.objects.filter(categoria=categoria).count()
        if count > 0:
            print(f"   {nome}: {count}")
    
    print("\nüéâ Dados de teste criados com sucesso!")
    print("\nüí° Pr√≥ximos passos:")
    print("   1. Execute as migra√ß√µes: python manage.py makemigrations publicacoes")
    print("   2. Aplique as migra√ß√µes: python manage.py migrate")
    print("   3. Acesse o admin em /admin/ para gerenciar as publica√ß√µes")
    print("   4. Acesse a p√°gina em /publicacoes/ para ver o resultado")
    print("\n‚ö†Ô∏è Nota: Para que as miniaturas sejam geradas automaticamente,")
    print("   voc√™ precisar√° fazer upload de arquivos PDF reais atrav√©s do admin.")

# Executar a fun√ß√£o
if __name__ == '__main__':
    criar_dados_teste()
else:
    # Quando executado via exec() no Django shell
    criar_dados_teste()

